<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.tripleaims.exhibition.dao.ArtistDAO">
	
	<select id="selectListArtists" parameterType="ArtistDTO" resultType="ArtistDTO">
		SELECT * FROM ARTIST
		<where>
			<if test="nameKor != null and nameKor != ''">
				NAME_KOR LIKE CONCAT('%',#{nameKor},'%')
			</if>
			<if test="nameEng != null and nameEng != ''">
				OR NAME_ENG LIKE CONCAT('%',#{nameEng},'%') 
			</if>
			<if test="deleteYn != null and deleteYn != ''">
				AND DELETE_YN = #{deleteYn}
			</if>
		</where>
		ORDER BY REG_DATE DESC
	</select>
	
	<select id="selectMaxArtistNo" resultType="java.lang.String">
		SELECT MAX(ARTIST_NO) FROM ARTIST WHERE ARTIST_NO LIKE CONCAT('130',DATE_FORMAT(NOW(),'%Y%m'),'%')
	</select>
	
	<insert id="insertArtist" parameterType="ArtistDTO">
		INSERT INTO ARTIST (ARTIST_NO, NAME_KOR, NAME_ENG, PROFILE, BIRTHDAY, PHONES, EMAILS, INTRODUCE, HISTORY, OPEN_YN, REG_DATE, EDIT_DATE)
		VALUES (#{artistNo},#{nameKor},#{nameEng},#{profile},#{birthday},#{phones},#{emails},#{introduce},#{history},#{openYn},now(),now())
	</insert>
	
	<!--  
	<insert id="insertArtist" parameterType="ArtistDTO">
		<selectKey keyProperty="artistNo" resultType="java.lang.String" order="BEFORE">
			SELECT CONCAT('130',DATE_FORMAT(SYSDATE(),'%Y%m'),LPAD(MAX(CAST(SUBSTRING(ARTIST_NO,9)AS INT))+1,5,0)) FROM ARTIST WHERE ARTIST_NO LIKE CONCAT('130',DATE_FORMAT(SYSDATE(),'%Y%m'),'%') 
		</selectKey>
	
		INSERT INTO ARTIST (ARTIST_NO, NAME_KOR, NAME_ENG, PROFILE, BIRTHDAY, PHONES, EMAILS, INTRODUCE, HISTORY, OPEN_YN, REG_DATE, EDIT_DATE)
		VALUES (
		<choose>
			<when test="artistNo == null or artistNo == ''">
				CONCAT('003',DATE_FORMAT(SYSDATE(),'%Y%m'),'00001')
			</when>
			<otherwise>
				#{artistNo}
			</otherwise>
		</choose>
			,#{nameKor},#{nameEng},#{profile},#{birthday},#{phones},#{emails},#{introduce},#{history},#{openYn},now(),now()
		)
	</insert>
	-->
	
	<insert id="insertArtistAddress" parameterType="ArtistAddressDTO">
		INSERT INTO ARTIST_ADDRESS (ARTIST_NO, ADDRESS_NAME, ADDRESSN, ADDRESS1, ADDRESS2, REG_DATE, EDIT_DATE)
		VALUES (#{artistNo},#{addressName},#{addressn},#{address1},#{address2},now(),now())
	</insert>
	
	
	<select id="artistList" parameterType="com.tripleaims.exhibition.dto.PagingParam" resultType="com.tripleaims.exhibition.dto.ArtistDTO">
		SELECT ARTIST_NO, NAME_KOR, NAME_ENG, PROFILE, BIRTHDAY, PHONES, EMAILS, INTRODUCE, HISTORY, OPEN_YN, DELETE_YN,REG_DATE, EDIT_DATE, HIT
		FROM (SELECT @ROWNUM:=@ROWNUM+1 RNUM, A.ARTIST_NO,NAME_KOR, A.NAME_ENG, A.PROFILE, A.BIRTHDAY, A.PHONES, A.EMAILS, A.INTRODUCE, A.HISTORY, A.OPEN_YN, A.DELETE_YN, A.REG_DATE, A.EDIT_DATE, A.HIT
				FROM artist A, (SELECT @ROWNUM:=0)R
				WHERE A.OPEN_YN = 'Y'
					<if test="search != null and search != ''">
				  		AND A.NAME_KOR LIKE CONCAT('%', #{search}, '%')
				 	</if> 
				ORDER BY A.NAME_KOR ASC) LIST
		   WHERE RNUM<![CDATA[>=]]> ${start} AND RNUM<![CDATA[<=]]>${end}
	</select>
	
	
	<select id="artistCount" parameterType="com.tripleaims.exhibition.dto.PagingParam" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM  artist
		WHERE OPEN_YN = 'Y'	
			<if test="search != null and search != ''">
				 AND NAME_KOR LIKE CONCAT('%', #{search}, '%')
			</if> 
	</select>
	
	<select id="artistDetail" parameterType="java.lang.String" resultType="com.tripleaims.exhibition.dto.ArtistDTO">
		SELECT  ARTIST_NO, NAME_KOR, NAME_ENG, PROFILE, BIRTHDAY, PHONES, EMAILS, INTRODUCE, HISTORY, OPEN_YN, DELETE_YN,REG_DATE, EDIT_DATE, HIT
		FROM artist
		WHERE ARTIST_NO=#{artistNo}
	</select>
	
	
	
	
	
	
	
	
	
	
</mapper>